input {
	tcp {
		port => 5000
		codec => multiline {
			pattern => "^%{TIMESTAMP_ISO8601}"
			negate => true
			what => "previous"
		}
	}
}

## Add your filters here
filter {
	grok {
		#match => { "message" => "
		#}
		match => { "message" => "(?<Timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{4})\|%{WORD:Hostname}\|%{POSINT:ProcessID}\|%{POSINT:ThreadID}\|%{LOGLEVEL:Log_Level}\|(?<Message_Source>.*)\|%{WORD:md5sum}\|%{GREEDYDATA:Message}\|" }
		match => { "message" => "(?<Timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{4})\|%{WORD:Hostname}\|%{POSINT:ProcessID}\|%{POSINT:ThreadID}\|%{LOGLEVEL:Log_Level}\|(?<Message_Source>.*)\|%{GREEDYDATA:Message}\|" }
		match => { "message" => "(?<Timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{4})\|%{WORD:Hostname}\|%{POSINT:ProcessID}\|%{POSINT:ThreadID}\|%{LOGLEVEL:Log_Level}\|(?<Message_Source>.*)\|%{GREEDYDATA:Message}" }
	}
	date {
		match => [ "Timestamp", "yyyy-MM-dd HH:mm:ss.SSSS" ]
	}
	mutate {
		remove_field => [ "md5sum" ]
	}
}

output {
	stdout {
		codec => rubydebug
	}
	elasticsearch {
		hosts => "elasticsearch:9200"
	}
}
